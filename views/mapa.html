<div style="margin-bottom: 20px; text-align: center;">
    <a href="/" style="text-decoration: none; color: #3a86ff; font-weight: bold;">← Zpět na seznam zemí</a>
</div>

<div id="regions_div" style="width: 100%; height: 600px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);"></div>

<div id="raw-data" style="display: none;">{{data}}</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', { 'packages':['geochart'] });
  google.charts.setOnLoadCallback(drawRegionsMap);

  function drawRegionsMap() {
    const dataString = document.getElementById('raw-data').innerText;
    const countries = dataString ? dataString.split(',') : [];
    
    console.log('Raw data:', dataString);
    console.log('Countries array:', countries);
    
    // Funkce na odstranění diakritiky
    function removeDiacritics(str) {
        return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }
    
    // přidáme další sloupec role tooltipu, aby se zobrazoval anglický název a počet
    const dataArray = [['Country', 'Navštíveno', {role: 'tooltip', p: {html: true}}]];

    // seznam **všech** států pro mapu (anglické názvy, pořádek není důležitý)
    const allCountries = [
        'Afghanistan','Albania','Algeria','Andorra','Angola','Antigua and Barbuda','Argentina','Armenia','Australia','Austria',
        'Azerbaijan','Bahamas','Bahrain','Bangladesh','Barbados','Belarus','Belgium','Belize','Benin','Bhutan','Bolivia','Bosnia and Herzegovina',
        'Botswana','Brazil','Brunei','Bulgaria','Burkina Faso','Burundi','Cabo Verde','Cambodia','Cameroon','Canada',
        'Central African Republic','Chad','Chile','China','Colombia','Comoros','Costa Rica','Cote d\'Ivoire','Croatia','Cuba',
        'Cyprus','Czechia','Democratic Republic of the Congo','Denmark','Djibouti','Dominica','Dominican Republic','Ecuador','Egypt','El Salvador',
        'Equatorial Guinea','Eritrea','Estonia','Eswatini','Ethiopia','Fiji','Finland','France','Gabon','Gambia','Georgia','Germany','Ghana','Greece','Grenada','Guatemala','Guinea','Guinea-Bissau','Guyana','Haiti','Honduras','Hungary','Iceland','India','Indonesia','Iran','Iraq','Ireland','Israel','Italy','Jamaica','Japan','Jordan','Kazakhstan','Kenya','Kiribati','Kosovo','Kuwait','Kyrgyzstan','Laos','Latvia','Lebanon','Lesotho','Liberia','Libya','Liechtenstein','Lithuania','Luxembourg','Madagascar','Malawi','Malaysia','Maldives','Mali','Malta','Marshall Islands','Mauritania','Mauritius','Mexico','Micronesia','Moldova','Monaco','Mongolia','Montenegro','Morocco','Mozambique','Myanmar','Namibia','Nauru','Nepal','Netherlands','New Zealand','Nicaragua','Niger','Nigeria','North Korea','North Macedonia','Norway','Oman','Pakistan','Palau','Panama','Papua New Guinea','Paraguay','Peru','Philippines','Poland','Portugal','Qatar','Republic of the Congo','Romania','Russia','Rwanda','Saint Kitts and Nevis','Saint Lucia','Saint Vincent and the Grenadines','Samoa','San Marino','Sao Tome and Principe','Saudi Arabia','Senegal','Serbia','Seychelles','Sierra Leone','Singapore','Slovakia','Slovenia','Solomon Islands','Somalia','South Africa','South Korea','South Sudan','Spain','Sri Lanka','Sudan','Suriname','Sweden','Switzerland','Syria','Tajikistan','Tanzania','Thailand','Timor-Leste','Togo','Tonga','Trinidad and Tobago','Tunisia','Turkey','Turkmenistan','Tuvalu','Uganda','Ukraine','United Arab Emirates','United Kingdom','United States','Uruguay','Uzbekistan','Vanuatu','Vatican City','Venezuela','Vietnam','Yemen','Zambia','Zimbabwe'
    ];

    // připravíme mapu s počty a naplníme všemi státy nulou
    const countMap = {};
    allCountries.forEach(name => { countMap[name] = 0; });

    // spočítáme výskyty vstupního seznamu
    countries.forEach(name => {
        const trimmed = name.trim();
        // používáme přímo upravený text (čekáme angličtinu od uživatele)
        const eng = trimmed;
        countMap[eng] = (countMap[eng] || 0) + 1;
    });

    // vložíme všechny řádky do dataArray
    Object.entries(countMap).forEach(([region, cnt]) => {
        // GeoChart už zobrazí název; tooltip necháme pouze s počtem
        const tool = `<div style=\"padding:5px;\">Navštíveno: ${cnt}</div>`;
        dataArray.push([region, cnt, tool]);
    });
    
    console.log('Final data array:', dataArray);

    const data = google.visualization.arrayToDataTable(dataArray);
    const options = {
      colorAxis: {minValue: 0, maxValue: 1, colors: ['#e0e0e0', '#ff006e']},
      backgroundColor: 'transparent',
      datalessRegionColor: '#e0e0e0',
      legend: 'none',
      tooltip: { isHtml: true }
    };

    const chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
    chart.draw(data, options);
  }
</script>